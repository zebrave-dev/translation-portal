<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Glossary Curation Tool (Admin)</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 1rem;
        }
        h1 { color: #4ecdc4; margin-bottom: 0.5rem; }
        .subtitle { color: #888; margin-bottom: 1.5rem; }

        .admin-warning {
            background: #dc2626;
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 1.25rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            border-radius: 8px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .back-link {
            display: inline-block;
            color: #4ecdc4;
            text-decoration: none;
            margin-bottom: 1rem;
        }
        .back-link:hover { text-decoration: underline; }

        .info-box {
            background: #252540;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #4ecdc4;
        }
        .info-box h3 { color: #4ecdc4; margin-bottom: 0.5rem; }
        .info-box p { color: #aaa; font-size: 0.9rem; line-height: 1.5; }

        .controls {
            background: #252540;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }
        .controls label { color: #aaa; }
        .controls select, .controls input {
            background: #1a1a2e;
            border: 1px solid #444;
            color: #eee;
            padding: 0.5rem;
            border-radius: 4px;
        }
        .filter-row {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .filter-btn {
            background: #333;
            color: #aaa;
            border: 1px solid #444;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .filter-btn:hover { background: #444; }
        .filter-btn.active {
            background: #4ecdc4;
            color: #1a1a2e;
            border-color: #4ecdc4;
        }

        button {
            background: #4ecdc4;
            color: #1a1a2e;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background: #3db8b0; }
        button.secondary {
            background: #666;
            color: #eee;
        }

        .stats {
            background: #252540;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }
        .stat { text-align: center; }
        .stat-value { font-size: 1.5rem; color: #4ecdc4; font-weight: bold; }
        .stat-label { font-size: 0.8rem; color: #888; }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #252540;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 80px;
        }
        th {
            background: #1a1a2e;
            padding: 0.75rem;
            text-align: left;
            color: #4ecdc4;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        td {
            padding: 0.75rem;
            border-bottom: 1px solid #333;
            vertical-align: top;
        }
        tr:hover { background: rgba(78, 205, 196, 0.1); }

        .term-name {
            font-weight: bold;
            color: #fff;
            font-size: 1.1rem;
        }
        .term-category {
            font-size: 0.75rem;
            color: #888;
            background: #333;
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
            margin-top: 4px;
        }
        .term-occurrences {
            color: #4ecdc4;
            font-weight: bold;
        }
        .examples {
            font-size: 0.8rem;
            color: #888;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s;
        }
        .examples.show {
            max-height: 200px;
            overflow-y: auto;
        }
        .example-item {
            background: #1a1a2e;
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.75rem;
        }
        .example-source {
            color: #666;
            font-size: 0.7rem;
        }
        .toggle-examples {
            font-size: 0.75rem;
            color: #4ecdc4;
            cursor: pointer;
            text-decoration: underline;
        }

        .decision-btns {
            display: flex;
            gap: 0.25rem;
        }
        .decision-btn {
            padding: 0.3rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 3px;
            cursor: pointer;
            border: 1px solid #444;
            background: #333;
            color: #aaa;
        }
        .decision-btn:hover { background: #444; }
        .decision-btn.yes { border-color: #22c55e; }
        .decision-btn.yes.active { background: #22c55e; color: #fff; }
        .decision-btn.later { border-color: #f59e0b; }
        .decision-btn.later.active { background: #f59e0b; color: #fff; }
        .decision-btn.no { border-color: #ef4444; }
        .decision-btn.no.active { background: #ef4444; color: #fff; }

        .note-input {
            width: 100%;
            background: #1a1a2e;
            border: 1px solid #444;
            color: #eee;
            padding: 0.3rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #252540;
            padding: 1rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
            border-top: 1px solid #444;
            z-index: 100;
        }

        .category-note {
            font-size: 0.75rem;
            color: #f59e0b;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="admin-warning">‚ö†Ô∏è ADMIN ONLY ‚Äî PLEASE DO NOT TOUCH ‚ö†Ô∏è</div>
    <a href="index.html" class="back-link">‚Üê Back to Translation Portal</a>
    <h1>Glossary Curation Tool</h1>
    <p class="subtitle">Decide which game terms need official in-game translations</p>

    <div class="info-box">
        <h3>How to use this tool</h3>
        <p>
            These terms were extracted from the gear_optimizer codebase. For each term, decide if translators
            need to look up the <strong>official in-game translation</strong> (by checking the Korean/Portuguese game client).
        </p>
        <p style="margin-top: 0.5rem;">
            <strong>Workflow:</strong> Mark terms as Yes/Later/No ‚Üí Click "Apply to Glossary" ‚Üí
            Copy downloaded file to <code>data/glossary.json</code> and <code>site/data/glossary.json</code> ‚Üí
            Commit and push. The Gaming Glossary tab in the main UI will then show these terms.
        </p>
    </div>

    <div class="controls">
        <div>
            <label>Filter: </label>
            <div class="filter-row">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="undecided">Undecided</button>
                <button class="filter-btn" data-filter="yes">Include ‚úì</button>
                <button class="filter-btn" data-filter="later">Later</button>
                <button class="filter-btn" data-filter="no">Exclude ‚úó</button>
            </div>
        </div>
        <div>
            <label>Category: </label>
            <select id="category-filter">
                <option value="all">All Categories</option>
            </select>
        </div>
        <div>
            <label>Search: </label>
            <input type="text" id="search" placeholder="Search terms...">
        </div>
    </div>

    <div class="stats">
        <div class="stat">
            <div class="stat-value" id="total-terms">0</div>
            <div class="stat-label">Total Terms</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="included-v1">0</div>
            <div class="stat-label">Include v1</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="later">0</div>
            <div class="stat-label">Later</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="excluded">0</div>
            <div class="stat-label">Excluded</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="undecided">0</div>
            <div class="stat-label">Undecided</div>
        </div>
    </div>

    <table id="terms-table">
        <thead>
            <tr>
                <th style="width: 25%">Term</th>
                <th style="width: 10%">Uses</th>
                <th style="width: 25%">Examples</th>
                <th style="width: 15%">Include in Glossary?</th>
                <th style="width: 25%">Notes</th>
            </tr>
        </thead>
        <tbody id="terms-body">
        </tbody>
    </table>

    <div class="actions">
        <button onclick="saveDecisions()">üíæ Save Decisions</button>
        <button onclick="applyToGlossary()">üöÄ Apply to Glossary</button>
        <button class="secondary" onclick="loadSaved()">üìÇ Load Saved</button>
        <button class="secondary" onclick="markAllUndecidedYes()">‚úì Mark All Undecided as Yes</button>
    </div>

    <script>
    let termsData = [];
    let categoryNotes = {};

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function toggleExamples(idx) {
        const el = document.getElementById(`examples-${idx}`);
        if (el) el.classList.toggle('show');
    }

    async function loadTerms() {
        try {
            const response = await fetch('data/glossary-curation-data.json');
            const data = await response.json();
            termsData = data.terms;
            categoryNotes = data.categoryNotes || {};
            renderTable();
            updateStats();
            populateCategories();
        } catch (e) {
            console.error('Failed to load terms:', e);
            document.getElementById('terms-body').innerHTML =
                '<tr><td colspan="5" style="text-align:center;color:#ff6b6b;">Failed to load terms. Run build_glossary_curation.py first.</td></tr>';
        }
    }

    function renderTable(filter = 'all', category = 'all', search = '') {
        const tbody = document.getElementById('terms-body');
        tbody.innerHTML = '';
        const searchLower = search.toLowerCase();

        termsData.forEach((term, idx) => {
            // Apply filters
            if (filter === 'undecided' && term.includeV1 !== 'undecided') return;
            if (filter === 'yes' && term.includeV1 !== 'yes') return;
            if (filter === 'later' && term.includeV1 !== 'later') return;
            if (filter === 'no' && term.includeV1 !== 'no') return;
            if (category !== 'all' && term.category !== category) return;
            if (search && !term.term.toLowerCase().includes(searchLower)) return;

            const catNote = categoryNotes[term.category] || '';

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <div class="term-name">${escapeHtml(term.term)}</div>
                    <div class="term-category">${escapeHtml(term.categoryName)}</div>
                    ${catNote ? `<div class="category-note">${escapeHtml(catNote)}</div>` : ''}
                </td>
                <td>
                    <span class="term-occurrences">${term.occurrences}</span>
                    <div style="font-size:0.75rem;color:#666;">${term.sectionCount} files</div>
                </td>
                <td>
                    <span class="toggle-examples" onclick="toggleExamples(${idx})">Show examples ‚ñº</span>
                    <div class="examples" id="examples-${idx}">
                        ${term.examples.map(ex => `
                            <div class="example-item">
                                "${escapeHtml(ex.text)}"
                                <div class="example-source">${escapeHtml(ex.source)}</div>
                            </div>
                        `).join('')}
                    </div>
                </td>
                <td>
                    <div class="decision-btns">
                        <button class="decision-btn yes ${term.includeV1 === 'yes' ? 'active' : ''}"
                                onclick="setDecision(${idx}, 'yes')">Yes</button>
                        <button class="decision-btn later ${term.includeV1 === 'later' ? 'active' : ''}"
                                onclick="setDecision(${idx}, 'later')">Later</button>
                        <button class="decision-btn no ${term.includeV1 === 'no' ? 'active' : ''}"
                                onclick="setDecision(${idx}, 'no')">No</button>
                    </div>
                </td>
                <td>
                    <input type="text" class="note-input"
                           value="${escapeHtml(term.notes || '')}"
                           placeholder="Optional notes..."
                           onchange="setNotes(${idx}, this.value)">
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    function setDecision(idx, decision) {
        termsData[idx].includeV1 = decision;
        updateStats();
        // Re-render to update button states
        const filter = document.querySelector('.filter-btn.active').dataset.filter;
        const category = document.getElementById('category-filter').value;
        const search = document.getElementById('search').value;
        renderTable(filter, category, search);
    }

    function setNotes(idx, notes) {
        termsData[idx].notes = notes;
    }

    function updateStats() {
        const total = termsData.length;
        const yes = termsData.filter(t => t.includeV1 === 'yes').length;
        const later = termsData.filter(t => t.includeV1 === 'later').length;
        const no = termsData.filter(t => t.includeV1 === 'no').length;
        const undecided = termsData.filter(t => t.includeV1 === 'undecided').length;

        document.getElementById('total-terms').textContent = total;
        document.getElementById('included-v1').textContent = yes;
        document.getElementById('later').textContent = later;
        document.getElementById('excluded').textContent = no;
        document.getElementById('undecided').textContent = undecided;
    }

    function populateCategories() {
        const select = document.getElementById('category-filter');
        const categories = [...new Set(termsData.map(t => t.category))];
        categories.sort();
        categories.forEach(cat => {
            const catName = termsData.find(t => t.category === cat)?.categoryName || cat;
            const option = document.createElement('option');
            option.value = cat;
            option.textContent = catName;
            select.appendChild(option);
        });
    }

    function saveDecisions() {
        const saveData = termsData.map(t => ({
            term: t.term,
            includeV1: t.includeV1,
            notes: t.notes
        }));
        localStorage.setItem('glossary-curation-decisions', JSON.stringify(saveData));
        alert('Decisions saved to browser storage!');
    }

    function loadSaved() {
        const saved = localStorage.getItem('glossary-curation-decisions');
        if (!saved) {
            alert('No saved decisions found.');
            return;
        }
        const savedData = JSON.parse(saved);
        savedData.forEach(s => {
            const term = termsData.find(t => t.term === s.term);
            if (term) {
                term.includeV1 = s.includeV1;
                term.notes = s.notes || '';
            }
        });
        updateStats();
        renderTable();
        alert('Loaded saved decisions!');
    }

    function applyToGlossary() {
        const included = termsData.filter(t => t.includeV1 === 'yes');

        if (included.length === 0) {
            alert('No terms marked as "Yes". Mark some terms to include first.');
            return;
        }

        // Group by category
        const categoryGroups = {};
        included.forEach(t => {
            if (!categoryGroups[t.category]) {
                categoryGroups[t.category] = {
                    name: t.categoryName,
                    terms: []
                };
            }
            categoryGroups[t.category].terms.push({
                en: t.term,
                context: categoryNotes[t.category] || "Check in-game for official translation"
            });
        });

        // Build glossary.json format (matches what main UI expects)
        const glossary = {
            _meta: {
                description: "Gaming terms that need consistent translation - look up official in-game translations",
                note: "These terms should match how the game officially translates them in each language",
                last_updated: new Date().toISOString().split('T')[0],
                total_terms: included.length
            },
            categories: categoryGroups
        };

        const blob = new Blob([JSON.stringify(glossary, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'glossary.json';
        a.click();
        URL.revokeObjectURL(url);

        alert(`Downloaded glossary.json with ${included.length} terms.\n\nTo apply:\n1. Copy to data/glossary.json\n2. Copy to site/data/glossary.json\n3. Commit and push`);
    }

    function markAllUndecidedYes() {
        termsData.forEach(t => {
            if (t.includeV1 === 'undecided') t.includeV1 = 'yes';
        });
        updateStats();
        renderTable();
    }

    // Event listeners
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const category = document.getElementById('category-filter').value;
            const search = document.getElementById('search').value;
            renderTable(btn.dataset.filter, category, search);
        });
    });

    document.getElementById('category-filter').addEventListener('change', (e) => {
        const filter = document.querySelector('.filter-btn.active').dataset.filter;
        const search = document.getElementById('search').value;
        renderTable(filter, e.target.value, search);
    });

    document.getElementById('search').addEventListener('input', (e) => {
        const filter = document.querySelector('.filter-btn.active').dataset.filter;
        const category = document.getElementById('category-filter').value;
        renderTable(filter, category, e.target.value);
    });

    // Initialize
    loadTerms();
    </script>
</body>
</html>
